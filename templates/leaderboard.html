{% extends "base.html" %}

{% block content %}
<h1>ğŸ† GLOBAL LEADERBOARD</h1>

{% if current_user and user_has_matches %}
    <div class="alert alert-info">
        <strong>Your Rank:</strong> #{{ current_user_rank }} 
        <span>- {{ current_user.rating }} Rating</span>
    </div>
{% else %}
    <p>Play matches to earn a spot on the leaderboard!</p>
{% endif %}
<!-- TOP50 -->
<div class="table-responsive mt-4">
    <table class="table table-dark table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Player</th>
                <th>Rating</th>
                <th>Rank Tier</th>
                <th>Record</th>
                <th>Win Rate</th>
            </tr>
        </thead>
        <tbody>
            {% for player in top_players %}
            <tr {% if current_user and player.id == current_user.id %}class="table-primary"{% endif %}>
                <td>
                    <strong>{{ loop.index }}</strong>
                    {% if loop.index == 1 %}ğŸ‘‘{% endif %}
                    {% if loop.index == 2 %}ğŸ¥ˆ{% endif %}
                    {% if loop.index == 3 %}ğŸ¥‰{% endif %}
                </td>
                <td>{{ player.username }}</td>
                <td><span style="color:yellow;">{{ player.rating }}</span></td>
                <td>
                    {% if player.rating >= 1600 %}ğŸ”® Nexus
                    {% elif player.rating >= 1400 %}ğŸŒŒ Quantum
                    {% elif player.rating >= 1200 %}ğŸ’» Mainframe
                    {% elif player.rating >= 1000 %}ğŸ–¥ï¸ Processor
                    {% elif player.rating >= 800 %}âš¡ Circuit
                    {% else %}ğŸ”§ Prototype{% endif %}
                </td>
                <td>
                    <span style="color: #00ffaa;">{{ player.wins }}W</span>
                    <span style="color: red;">{{ player.losses }}L</span>
                </td>
                <td>{{ "%.1f"|format(player.win_rate) }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- NEARBY PLAYERS (only if user is ranked below 50) -->
{% if show_nearby %}
<div class="table-responsive mt-5">
    <div class="text-center my-4">
        <h4>...</h4>
        <p>Players ranked #51 - #{{ nearby_start_rank - 1 }}</p>
    </div>
    
    <h3>Your Competition (Nearby Players)</h3>
    <table class="table table-dark table-striped">
        <thead>
            <tr>
                <th>#</th>
                <th>Player</th>
                <th>Rating</th>
                <th>Rank Tier</th>
                <th>Record</th>
                <th>Win Rate</th>
            </tr>
        </thead>
        <tbody>
            {% for player in nearby_players %}
            <tr {% if current_user and player.id == current_user.id %}class="table-success fw-bold"{% endif %}>
                <td>
                    <strong>{{ nearby_start_rank + loop.index0 }}</strong>
                    {% if current_user and player.id == current_user.id %}ğŸ‘ˆ YOU{% endif %}
                </td>
                <td>{{ player.username }}</td>
                <td><span style="color:yellow;">{{ player.rating }}</span></td>
                <td>
                    {% if player.rating >= 1600 %}ğŸ”® Nexus
                    {% elif player.rating >= 1400 %}ğŸŒŒ Quantum
                    {% elif player.rating >= 1200 %}ğŸ’» Mainframe
                    {% elif player.rating >= 1000 %}ğŸ–¥ï¸ Processor
                    {% elif player.rating >= 800 %}âš¡ Circuit
                    {% else %}ğŸ”§ Prototype{% endif %}
                </td>
                <td>
                    <span style="color: #00ffaa;">{{ player.wins }}W</span>
                    <span style="color: red;">{{ player.losses }}L</span>
                </td>
                <td>{{ "%.1f"|format(player.win_rate) }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">â† Back</a>
</div>
{% endblock %}