{% extends "base.html" %}

{% block content %}
<div>

    <h2>Battle: {{ bot1.name }} vs {{ bot2.name }}</h2>

    <h3 class="mt-4">Starting Stats Comparison</h3>

        <table class="stats-comparison table table-bordered text-center mb-4">
            <thead>
                <tr>
                    <th>Stat</th>
                    <th>{{ bot1.name }}</th>
                    <th>{{ bot2.name }}</th>
                </tr>
            </thead>

            <tbody>
                <!-- WEAPON ROW -->
                <tr>
                    <td><strong>WEAPON</strong></td>
                    <td>
                        {% if stats1.weapon_type %}
                            <span>{{ stats1.weapon_type|upper }}</span>
                            <br>
                            <small>+{{ stats1.weapon_atk }} ATK</small>
                        {% else %}
                            <span>No Weapon</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if stats2.weapon_type %}
                            <span>{{ stats2.weapon_type|upper }}</span>
                            <br>
                            <small>+{{ stats2.weapon_atk }} ATK</small>
                        {% else %}
                            <span>No Weapon</span>
                        {% endif %}
                    </td>
                </tr>

                <!-- PROC (Total ATK including weapon) ROW -->
                <tr>
                    <td>PROC</td>
                    <td class="{% if stats1.proc > stats2.proc %}text-success fw-bold{% elif stats1.proc < stats2.proc %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.proc }}
                        {% if stats1.weapon_atk > 0 %}
                            <br><small>(Base + {{ stats1.weapon_atk }} weapon)</small>
                        {% endif %}
                    </td>
                    <td class="{% if stats2.proc > stats1.proc %}text-success fw-bold{% elif stats2.proc < stats1.proc %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.proc }}
                        {% if stats2.weapon_atk > 0 %}
                            <br><small>(Base + {{ stats2.weapon_atk }} weapon)</small>
                        {% endif %}
                    </td>
                </tr>

                <!-- HP ROW -->
                <tr>
                    <td>INT</td>
                    <td class="{% if stats1.hp > stats2.hp %}text-success fw-bold{% elif stats1.hp < stats2.hp %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.hp }}
                    </td>
                    <td class="{% if stats2.hp > stats1.hp %}text-success fw-bold{% elif stats2.hp < stats1.hp %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.hp }}
                    </td>
                </tr>

                <!-- ENERGY ROW -->
                <tr>
                    <td>PWR</td>
                    <td class="{% if stats1.energy > stats2.energy %}text-success fw-bold{% elif stats1.energy < stats2.energy %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.energy }}
                    </td>
                    <td class="{% if stats2.energy > stats1.energy %}text-success fw-bold{% elif stats2.energy < stats1.energy %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.energy }}
                    </td>
                </tr>

                <!-- DEFENSE ROW -->
                <tr>
                    <td>DEF</td>
                    <td class="{% if stats1.defense > stats2.defense %}text-success fw-bold{% elif stats1.defense < stats2.defense %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.defense }}
                    </td>
                    <td class="{% if stats2.defense > stats1.defense %}text-success fw-bold{% elif stats2.defense < stats1.defense %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.defense }}
                    </td>
                </tr>

                <!-- CLK (SPEED) ROW -->
                <tr>
                    <td>CLK</td>
                    <td class="{% if stats1.clk > stats2.clk %}text-success fw-bold{% elif stats1.clk < stats2.clk %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.clk }}
                    </td>
                    <td class="{% if stats2.clk > stats1.clk %}text-success fw-bold{% elif stats2.clk < stats1.clk %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.clk }}
                    </td>
                </tr>

                <!-- LUCK ROW -->
                <tr>
                    <td>ENT</td>
                    <td class="{% if stats1.luck > stats2.luck %}text-success fw-bold{% elif stats1.luck < stats2.luck %}text-danger{% else %}text-light{% endif %}">
                        {{ stats1.luck }}
                    </td>
                    <td class="{% if stats2.luck > stats1.luck %}text-success fw-bold{% elif stats2.luck < stats1.luck %}text-danger{% else %}text-light{% endif %}">
                        {{ stats2.luck }}
                    </td>
                </tr>
            </tbody>
        </table>

    <div>
        <div style="
            max-height: 70vh;
            overflow-y: auto;
            background: black;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            white-space: pre-wrap;
        ">
            {% for type, line in log %}
                <span class="log-text {{type}}">{{ line }}</span>
            {% endfor %}
        </div>
    </div>

    {% if winner %}
    <div class="alert alert-success mt-3">
        Winner: {{ winner }}
    </div>
    {% endif %}

    <a href="{{ url_for('bot_details', bot_id=bot1.id) }}" class="btn btn-secondary mt-3">Back</a>

</div>
{% endblock %}